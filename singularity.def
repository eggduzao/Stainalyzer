Bootstrap: docker
From: python:3.12  # Base image with Python 3.12

%post
    # Update and install APT packages
    apt-get update && apt-get install -y \
        build-essential \
        wget \
        curl \
        git \
        bedtools \
        default-jdk \
        ffmpeg \
        gdal-bin \
        gfortran \
        graphviz \
        htslib \
        libatlas-base-dev \
        libavcodec-dev \
        libavformat-dev \
        libbz2-dev \
        libcurl4-openssl-dev \
        libdlib-dev \
        libffi-dev \
        libgeos-dev \
        libgl1-mesa-glx \
        libglib2.0-0 \
        libgsl0-dev \
        libhdf5-dev \
        libheif-dev \
        libjpeg-dev \
        liblapack-dev \
        liblzma-dev \
        libncurses5-dev \
        libncursesw5-dev \
        libnetcdf-dev \
        libopenblas-dev \
        libopencv-dev \
        libpng-dev \
        libproj-dev \
        libreadline-dev \
        libsm6 \
        libsndfile1 \
        libsqlite3-dev \
        libssl-dev \
        libswscale-dev \
        libtiff-dev \
        libv4l-dev \
        libxext6 \
        libxml2-dev \
        libxrender-dev \
        libxslt1-dev \
        openjdk-11-jdk \
        python3.12 \
        python3.12-venv \
        python3.12-dev \
        python3-pip \
        r-base \
        samtools \
        zlib1g-dev

    # Install Miniconda
    wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh
    bash miniconda.sh -b -p /opt/conda
    rm miniconda.sh

    # Initialize Conda
    /opt/conda/bin/conda init bash

    # Create Conda environment and install Python packages
    /opt/conda/bin/conda create -n base_env python=3.12 -y
    /opt/conda/bin/conda install -n base_env HTSeq SimpleITK albumentations altair anndata yellowbrick -y
    /opt/conda/bin/conda install -n base_env annoy apex av bambi bayesian-optimization bioblend -y
    /opt/conda/bin/conda install -n base_env biopython biopython-extras bitstring catboost category_encoders -y
    /opt/conda/bin/conda install -n base_env cobra cvxpy dagster dash dask datashader datatable -y
    /opt/conda/bin/conda install -n base_env deeplearning4j detectron2 duckdb dvc efficientnet-pytorch -y
    /opt/conda/bin/conda install -n base_env eli5 face_recognition faiss-cpu fastai feature-engine featuretools -y
    /opt/conda/bin/conda install -n base_env ffmpeg-python fuzzywuzzy geopandas gffutils gplearn -y
    /opt/conda/bin/conda install -n base_env great_expectations gym h2o h5py holoviews horovod huggingface-hub -y
    /opt/conda/bin/conda install -n base_env hydra-core hyperopt imageio imbalanced-learn imgaug joblib -y
    /opt/conda/bin/conda install -n base_env jupyterlab kedro keras keras-tuner librosa lightgbm lime -y
    /opt/conda/bin/conda install -n base_env luigi mahotas matplotlib>=3.3.0 methylpy missingno zarr -y
    /opt/conda/bin/conda install -n base_env ml-dtypes mleap mlflow mlxtend modin[all] moviepy multiqc -y
    /opt/conda/bin/conda install -n base_env mxnet netCDF4 numpy>=1.18.0 onnx open3d opencv-python openpyxl -y
    /opt/conda/bin/conda install -n base_env optuna pandas>=1.0.0 pandera patsy pillow plotly polars protobuf -y
    /opt/conda/bin/conda install -n base_env py7zr pyBigWig pyaudio pybedtools pybzip2 pycaret pycocotools -y
    /opt/conda/bin/conda install -n base_env pydantic pydicom pydot pyensembl pyheif pyjanitor pymc3 pymetagenomics -y
    /opt/conda/bin/conda install -n base_env pymzml pysam pyspark pyteomics pytesseract python-dateutil pytorch-lightning -y
    /opt/conda/bin/conda install -n base_env pytz pyvips pywavelets pyyaml ray requests rna-tools rpy2 scanpy -y
    /opt/conda/bin/conda install -n base_env scikit-bio scikit-image scikit-learn>=0.23.0 scikit-optimize -y
    /opt/conda/bin/conda install -n base_env scipy>=1.5.0 seaborn>=0.11.0 shap skorch snakemake soundfile -y
    /opt/conda/bin/conda install -n base_env sqlalchemy stylegan3 sympy tabulate tensorboard tensorboardX -y
    /opt/conda/bin/conda install -n base_env tensorflow tifffile torch>=1.7.0 torchaudio torchvision>=0.8.0 tpot -y
    /opt/conda/bin/conda install -n base_env tqdm transformers vaex vcfpy xgboost xlrd xlwt ydata-profiling -y

%environment
    export PATH="/opt/conda/bin:$PATH"
    export LC_ALL=C.UTF-8
    export LANG=C.UTF-8

%runscript
    source /opt/conda/bin/activate base_env
    exec python "$@"
